from collections.abc import Iterable
from tsumemi.src.shogi.basetypes import KomaType, Side


class MovegenTestCase:
    def __init__(
        self,
        name: str,
        ktype: KomaType,
        sfen: str,
        expected_moves: dict[Side, Iterable[str]],
    ):
        self.name = name
        self.ktype = ktype
        self.sfen = sfen
        self.expected_moves = expected_moves


fu_test = MovegenTestCase(
    "test_fu_moves",
    KomaType.FU,
    "p1p4P1/2P5P/3p3P1/3P4P/9/p4p3/1p3P3/p5p2/1p4P1P b - 1",
    {
        Side.SENTE: [
            "P18(19)",
            "P13(14)",
            "P13(14)+",
            "P11(12)+",
            "P22(23)",
            "P22(23)+",
            "P38(39)",
            "P46(47)",
            "P63(64)",
            "P63(64)+",
            "P71(72)+",
        ],
        Side.GOTE: [
            "P39(38)+",
            "P47(46)",
            "P47(46)+",
            "P64(63)",
            "P72(71)",
            "P88(87)",
            "P88(87)+",
            "P92(91)",
            "P97(96)",
            "P97(96)+",
            "P99(98)+",
        ],
    },
)

ky_test = MovegenTestCase(
    "test_ky_moves",
    KomaType.KY,
    "4p4/4L2P1/5L2l/6l2/9/7L1/5l2L/4l1p2/4P4 b - 1",
    {
        Side.SENTE: [
            "L16(17)",
            "L15(17)",
            "L14(17)",
            "L13(17)",
            "L13(17)+",
            "L25(26)",
            "L24(26)",
            "L23(26)",
            "L23(26)+",
            "L42(43)",
            "L42(43)+",
            "L41(43)+",
            "L51(52)+",
        ],
        Side.GOTE: [
            "L14(13)",
            "L15(13)",
            "L16(13)",
            "L17(13)",
            "L17(13)+",
            "L35(34)",
            "L36(34)",
            "L37(34)",
            "L37(34)+",
            "L48(47)",
            "L48(47)+",
            "L49(47)+",
            "L59(58)+",
        ],
    },
)

ke_test = MovegenTestCase(
    "test_ke_moves",
    KomaType.KE,
    "N7N/4N1n2/9/5N3/n2n1N2N/3n5/9/2N1n4/n7n b - 1",
    {
        Side.SENTE: [
            "N23(15)",
            "N23(15)+",
            "N32(44)+",
            "N53(45)",
            "N53(45)+",
            "N33(45)",
            "N33(45)+",
            "N66(78)",
            "N86(78)",
        ],
        Side.GOTE: [
            "N24(32)",
            "N44(32)",
            "N57(65)",
            "N57(65)+",
            "N77(65)",
            "N77(65)+",
            "N78(66)+",
            "N87(95)",
            "N87(95)+",
        ],
    },
)

gi_test = MovegenTestCase(
    "test_gi_moves",
    KomaType.GI,
    "8S/7s1/7S1/6S2/9/6s2/7s1/7S1/8s b - 1",
    {
        Side.SENTE: [
            "S22(11)",
            "S22(11)+",
            "S22(23)",
            "S22(23)+",
            "S12(23)",
            "S12(23)+",
            "S32(23)",
            "S32(23)+",
            "S14(23)",
            "S14(23)+",
            "S33(34)",
            "S33(34)+",
            "S43(34)",
            "S43(34)+",
            "S25(34)",
            "S45(34)",
            "S17(28)",
            "S27(28)",
            "S37(28)",
            "S19(28)",
            "S39(28)",
        ],
        Side.GOTE: [
            "S28(19)",
            "S28(19)+",
            "S28(27)",
            "S28(27)+",
            "S18(27)",
            "S18(27)+",
            "S38(27)",
            "S38(27)+",
            "S16(27)",
            "S16(27)+",
            "S37(36)",
            "S37(36)+",
            "S47(36)",
            "S47(36)+",
            "S25(36)",
            "S45(36)",
            "S13(22)",
            "S23(22)",
            "S33(22)",
            "S11(22)",
            "S31(22)",
        ],
    },
)

ki_test = MovegenTestCase(
    "test_ki_moves",
    KomaType.KI,
    "8G/7G1/7g1/9/9/9/7G1/7g1/8g b - 1",
    {
        Side.SENTE: [
            "G12(11)",
            "G21(11)",
            "G31(22)",
            "G21(22)",
            "G32(22)",
            "G12(22)",
            "G23(22)",
            "G36(27)",
            "G26(27)",
            "G16(27)",
            "G37(27)",
            "G17(27)",
            "G28(27)",
        ],
        Side.GOTE: [
            "G18(19)",
            "G29(19)",
            "G39(28)",
            "G29(28)",
            "G38(28)",
            "G18(28)",
            "G27(28)",
            "G34(23)",
            "G24(23)",
            "G14(23)",
            "G33(23)",
            "G13(23)",
            "G22(23)",
        ],
    },
)

ka_test = MovegenTestCase(
    "test_ka_moves",
    KomaType.KA,
    "9/7P1/9/5B3/9/3b5/9/1p7/9 b - 1",
    {
        Side.SENTE: [
            "B71(44)",
            "B71(44)+",
            "B62(44)",
            "B62(44)+",
            "B53(44)",
            "B53(44)+",
            "B33(44)",
            "B33(44)+",
            "B55(44)",
            "B66(44)",
            "B35(44)",
            "B26(44)",
            "B17(44)",
        ],
        Side.GOTE: [
            "B39(66)",
            "B39(66)+",
            "B48(66)",
            "B48(66)+",
            "B57(66)",
            "B57(66)+",
            "B77(66)",
            "B77(66)+",
            "B55(66)",
            "B44(66)",
            "B75(66)",
            "B84(66)",
            "B93(66)",
        ],
    },
)

hi_test = MovegenTestCase(
    "test_hi_moves",
    KomaType.HI,
    "9/3p5/9/9/2Pr1Rp2/9/9/5P3/9 b - 1",
    {
        Side.SENTE: [
            "R41(45)",
            "R41(45)+",
            "R42(45)",
            "R42(45)+",
            "R43(45)",
            "R43(45)+",
            "R44(45)",
            "R55(45)",
            "R65(45)",
            "R35(45)",
            "R46(45)",
            "R47(45)",
        ],
        Side.GOTE: [
            "R69(65)",
            "R69(65)+",
            "R68(65)",
            "R68(65)+",
            "R67(65)",
            "R67(65)+",
            "R66(65)",
            "R55(65)",
            "R45(65)",
            "R75(65)",
            "R64(65)",
            "R63(65)",
        ],
    },
)

MOVEGEN_TEST_CASES = [fu_test, ky_test, ke_test, gi_test, ki_test, ka_test, hi_test]
